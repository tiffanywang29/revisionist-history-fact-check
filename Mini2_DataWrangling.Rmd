---
title: "Should We Be Going to Schools with Bad Food?"
author: "Chase Williamson and Tiffany Wang"
date: "Spring 2018"
output: html_document
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Mini-Project 2: Data Wrangling

We're sure many of you have heard of Malcolm Gladwell, a famous economist who has written multiple books and now hosts a podcast called Revisionist History. In its first season, Gladwell aired an episode named [Food Fight](http://revisionisthistory.com/episodes/05-food-fight), highlighting the relationship between college endowment, money spent on food services, and number of low-income students at higher education instutions by comparing Vassar to Bowdoin. He argues that while Vassar cannot offer the luxury goods like hiring a chef to design delicious meals, its commitment to admitting low income students and making their education affordable is much more important and worth the sacrifice for students who can pay full tuition.

Now, we believe this is a noble cause but feel a little uneasy about Gladwell's use of two specific colleges to make a generalization for all institutions. Surely there must be other factors. And what about the quality of education? We took a list of the [50 colleges](https://www.bestvalueschools.com/rankings/college-dining-halls/) with the best food in 2017 to compare them with various school stats from the U.S. Department of Education's [College Scorecard](https://collegescorecard.ed.gov/data/documentation/) data to verify Gladwell's claim.

First, we needed to download some necessary packages for scraping data from the web and doing some data wrangling.
```{r}
library(readr)
library(dplyr)
library(httr)
library(rvest)
library(tidyr)
```

Here we grabbed the list from the college food rankings from the web and converted it into a form that could be used in R.
```{r}
#Assign url containing college food rankings to url.food
url.food <- "https://www.bestvalueschools.com/rankings/college-dining-halls/"

#Scrape food rankings from url
good.foods <- url.food %>%
  read_html() %>%
  html_nodes(css = "h3") %>%
  html_text()

#Convert text object that we scraped to a dataframe with two columns: rank and school name
good.foods <- as.data.frame(good.foods) %>%
  filter(good.foods != "The 50 Colleges with the Best Food Ranking Methodology") %>%
  separate(col = good.foods, 
           into = c("food_rank", "school"), 
           extra = "merge")
```

Now we downloaded the information from the College Scorecard. They have A LOT of data, so we chose a few specific variables to analyze: 
-ownership of institution (public, private nonprofit, private for-profit)
-percent of students who receive a Pell Grant
-percent of first generation students
-cost of institution (separate variables for public and private)
There was only data available up to 2015, so we grabbed that, assuming that the food didn't change drastically between then and now.
```{r}
#Downloading the package to help load the data.
library(rscorecard)
#We have to use a key so that the government knows who's using their data
my_key <- "1HADPASnygYXC2p1ZxFMAN7j2VnS9IFDdvDMKZTW"
url <- "https://api.data.gov/ed/collegescorecard/v1/schools?"
scrape_scorecard <- GET(url, query = list(api_key = my_key))
sc_key(my_key)
dat <- sc_init() %>%
  sc_select(control, pctpell, PAR_ED_PCT_1STGEN, instnm, npt4_pub, npt4_priv) %>%
  sc_year(2015) %>%
  sc_get()
#Combining the two variables of cost of public and private institutions 
dat <-  gather(dat, npt4_pub, npt4_priv, key = "Type of School", value = "Cost")
```

Now we merged the two datasets so that we can visually compare the different variables regarding money with the quality of food.
```{r}
colleges_food <- left_join(dat, good.foods, by = c("instnm" = "school"))

#Downloading ggplot to make plots.
library(ggplot2)
ggplot(colleges_food, aes(x = pctpell, y = Cost, color = as.factor(food_rank))) + 
  geom_point(alpha = .6)
```
~Some analysis~

Obviously, cost, and definitely not food ranking, is not the only factor that goes into your choice of college. We also wanted to look at the school ranking to see if this phenomenon is apparent with top-ranked schools. We gathered information from [Forbes'](https://en.wikipedia.org/wiki/Forbes_Magazine%27s_List_of_America%27s_Best_Colleges) list of "America's Best Colleges" in 2017 and then merged this new dataset to our previously existing one.
```{r}
#Assign url containing college rankings to url.rank
url.rank <- "https://en.wikipedia.org/wiki/Forbes_Magazine%27s_List_of_America%27s_Best_Colleges"

#Scrape Forbes college rankings from wikipedia
forbes.top25 <- url.rank %>%
  read_html() %>%
  html_nodes(css = "li") %>%
  html_text() 

#Remove extraneous material
forbes.top25 <- as.data.frame(forbes.top25[c(1:25)])

#Create column containing college ranks. Note: that the colleges are in ranked order, but there is not a rank variable
forbes.top25$forbes_rank <- seq.int(nrow(forbes.top25))

#Label columns
colnames(forbes.top25) <- c("school", "forbes_rank")

#Merge college scorecard + food ranking data with college ranking data
colleges_food_rank <- left_join(colleges_food, 
                                forbes.top25, 
                                by = c("instnm" = "school"))

#Create "food_ranked" and "forbes_ranked" dummy variable indicating if the variable is labeled in that particular category
colleges_food_rank <- colleges_food_rank %>%
  mutate(food_rank = as.numeric(food_rank), 
         forbes_rank = as.numeric(forbes_rank)) %>%
  mutate(food_ranked = as.numeric(!is.na(food_rank)), 
         forbes_ranked = as.numeric(!is.na(forbes_rank))) 

```

In this R chunk, we look at a few different visualizations
```{r}
#What if we just look at school categories?
private_food <- colleges_food_rank %>%
  filter(!is.na(pctpell), !is.na(par_ed_pct_1stgen)) %>%
  group_by(control, food_ranked) %>%
  summarise(mean_pctpell = mean(pctpell), 
            mean_par_ed_pct_1stgen = mean(par_ed_pct_1stgen))

ggplot(private_food, aes(x = mean_par_ed_pct_1stgen, y = mean_pctpell, color = as.factor(food_ranked))) + 
  geom_point()

#What if we only look at schools that are ranked in the top 25 by forbes? 
forbes_ranked_only <- filter(colleges_food_rank, forbes_ranked==1)
ggplot(forbes_ranked_only, aes(x = par_ed_pct_1stgen, y = pctpell, color = as.factor(food_ranked))) + 
  geom_point()

#Does the cost of the school have to do with the quality of food?
ggplot(colleges_food_rank, aes(x = as.character(food_ranked), y = Cost)) + 
  geom_boxplot()

#But how about when we just take the "good" schools?
ggplot(forbes_ranked_only, aes(x = as.character(food_ranked), y = Cost)) + 
  geom_boxplot()
```

In this R chunk, we show summary stats
```{r}



```


