---
title: "Insert Title"
author: "Chase Williamson and Tiffany Wang"
date: "Spring 2018"
output: html_document
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Mini-Project 2: Data Wrangling
Downloading some necessary packages for scraping data from the web and doing some data wrangling.
```{r}
library(readr)
library(dplyr)
library(httr)
library(rvest)
library(tidyr)
```

In this R chunk we scrape food rankings.
```{r}
#Assign url containing college food rankings to url.food
url.food <- "https://www.bestvalueschools.com/rankings/college-dining-halls/"

#Scrape food rankings from url
good.foods <- url.food %>%
  read_html() %>%
  html_nodes(css = "h3") %>%
  html_text()

#Convert text object that we scraped to a dataframe with two columns: rank and school name
good.foods <- as.data.frame(good.foods) %>%
  filter(good.foods != "The 50 Colleges with the Best Food Ranking Methodology") %>%
  separate(col = good.foods, into = c("food_rank", "school"), extra = "merge")
```

In this R chunk we scrape Forbes college rankings
```{r}
#Assign url containing college rankings to url.rank
url.rank <- "https://en.wikipedia.org/wiki/Forbes_Magazine%27s_List_of_America%27s_Best_Colleges"

#Scrape Forbes college rankings from wikipedia
forbes.top25 <- url.rank %>%
  read_html() %>%
  html_nodes(css = "li") %>%
  html_text() 

#Remove extraneous material
forbes.top25 <- as.data.frame(forbes.top25[c(1:25)])

#Create column containing college ranks. Note: that the colleges are in ranked order, but there is not a rank variable
forbes.top25$forbes_rank <- seq.int(nrow(forbes.top25))

#Label columns
colnames(forbes.top25) <- c("school", "forbes_rank")
```


In this R chunk, we import data from the college scorecard dataset
```{r}
#Downloading the package to help load the data.
library(rscorecard)
#Uploaded some of the variables I thought would be interesting to look at
my_key <- "1HADPASnygYXC2p1ZxFMAN7j2VnS9IFDdvDMKZTW"
url <- "https://api.data.gov/ed/collegescorecard/v1/schools?"
scrape_scorecard <- GET(url, query = list(api_key = my_key))
sc_key(my_key)
dat <- sc_init() %>%
  sc_select(control, pctpell, PAR_ED_PCT_1STGEN, instnm, npt4_pub, npt4_priv) %>%
  sc_year(2015) %>%
  sc_get()
dat <-  gather(dat, npt4_pub, npt4_priv, key = "Type of School", value = "Cost")
```


In this R chunk, we merge the three datasets.
```{r}
#Merge college scorecard data with food ranking data
colleges_food <- left_join(dat, good.foods, by = c("instnm" = "school"))

#Merge college scorecard + food ranking data with college ranking data
colleges_food_rank <- left_join(colleges_food, forbes.top25, by = c("instnm" = "school"))

#Create "food_ranked" and "forbes_ranked" dummy variable indicating if the variable is labeled in that particular category
colleges_food_rank <- colleges_food_rank %>%
  mutate(food_rank = as.numeric(food_rank), forbes_rank = as.numeric(forbes_rank)) %>%
  mutate(food_ranked = as.numeric(!is.na(food_rank)), forbes_ranked = as.numeric(!is.na(forbes_rank))) 

```

In this R chunk, we look at a few different visualizations
```{r}
#Downloading ggplot to make plots.
library(ggplot2)
#Start with Tiffany's original plot
ggplot(colleges_food, aes(x = pctpell, y = par_ed_pct_1stgen, color = as.factor(food_rank))) + 
  geom_point(alpha = .6)

#What if we just look at school categories?
private_food <- colleges_food_rank %>%
  filter(!is.na(pctpell), !is.na(par_ed_pct_1stgen)) %>%
  group_by(control, food_ranked) %>%
  summarise(mean_pctpell = mean(pctpell), mean_par_ed_pct_1stgen = mean(par_ed_pct_1stgen))

ggplot(private_food, aes(x = mean_par_ed_pct_1stgen, y = mean_pctpell, color = as.factor(food_ranked))) + 
  geom_point()

#What if we only look at schools that are ranked in the top 25 by forbes? 
forbes_ranked_only <- filter(colleges_food_rank, forbes_ranked==1)
ggplot(forbes_ranked_only, aes(x = par_ed_pct_1stgen, y = pctpell, color = as.factor(food_ranked))) + 
  geom_point()

#Does the cost of the school have to do with the quality of food?
ggplot(colleges_food_rank, aes(x = as.character(food_ranked), y = Cost)) + 
  geom_boxplot()
```

In this R chunk, we show summary stats
```{r}



```


